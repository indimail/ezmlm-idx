# This file is automatically generated, do not edit.
SHELL=/bin/sh
prefix=$(shell head -1 conf-prefix 2>/dev/null)
default: it

all: \
it installer mysql pgsql sqlite3 man

altpath.lo: \
libcompile altpath.c config.h die.h slurp.h \
altpath.h idx.h auto_etc.h
	./libcompile altpath.c

author.lo: \
libcompile author.c die.h mime.h
	./libcompile author.c

auto_bin.c: \
auto-str conf-bin
	./auto-str auto_bin EZMLM_BIN <conf-bin >auto_bin.c

auto_bin.lo: \
libcompile auto_bin.c
	./libcompile auto_bin.c

auto-ccld.sh: \
conf-cc conf-cclo conf-ld conf-ldso warn-auto.sh
	( cat warn-auto.sh; \
	echo CC=\'`head -n 1 conf-cc`\'; \
	echo CCLO=\'`head -n 1 conf-cclo`\'; \
	echo LD=\'`head -n 1 conf-ld`\'; \
	echo LDSO=\'`head -n 1 conf-ldso`\'; \
	) > auto-ccld.sh

auto_cron.c: \
auto-str conf-cron
	./auto-str auto_cron <conf-cron >auto_cron.c

auto_cron.lo: \
libcompile auto_cron.c
	./libcompile auto_cron.c

auto_etc.c: \
auto-str conf-etc
	./auto-str auto_etc EZMLM_ETC <conf-etc >auto_etc.c

auto_etc.lo: \
libcompile auto_etc.c
	./libcompile auto_etc.c

auto_lib.c: \
auto-str conf-lib
	./auto-str auto_lib EZMLM_LIB <conf-lib >auto_lib.c

auto_lib.lo: \
libcompile auto_lib.c
	./libcompile auto_lib.c

auto_qmail.c: \
auto-str conf-qmail
	./auto-str auto_qmail <conf-qmail >auto_qmail.c

auto_qmail.lo: \
libcompile auto_qmail.c
	./libcompile auto_qmail.c

auto-str: \
load auto-str.o
	./load auto-str -lqmail

auto-str.o: \
compile auto-str.c
	./compile auto-str.c

VERSION: \
conf-version
	(echo ezmlm-idx-"`head -n 1 conf-version`"; \
	echo "derived from ezmlm-0.53") > VERSION

auto_version.c: \
auto-str VERSION
	./auto-str auto_version < VERSION > auto_version.c

auto_version.lo: \
libcompile auto_version.c
	./libcompile auto_version.c

choose: \
warn-auto.sh choose.sh
	cat warn-auto.sh choose.sh > choose
	chmod 755 choose

distclean: TARGETS
	rm -f `cat TARGETS`

clean: \
TARGETS
	rm -f `cat TARGETS`

compile: \
make-compile warn-auto.sh systype
	( cat warn-auto.sh; ./make-compile "`cat systype`" ) > compile
	chmod 755 compile

concatHDR.lo: \
libcompile concatHDR.c \
mime.h messages.h die.h idx.h
	./libcompile concatHDR.c

config.lo: \
libcompile config.c config.h die.h \
messages.h getconf.h idx.h slurp.h wrap.h
	./libcompile config.c

cookie.lo: \
libcompile cookie.c cookie.h surfpcs.h
	./libcompile cookie.c

copy.lo: \
libcompile copy.c qmail.h \
messages.h quote.h copy.h cookie.h mime.h altpath.h cookie.h \
die.h idx.h config.h
	./libcompile copy.c

crypt.lib: \
compile load trylib.c
	( ( ./compile trylib.c && ./load trylib -lcrypt ) >/dev/null 2>&1 && echo -lcrypt || exit 0 ) >crypt.lib
	rm -f trylib.o trylib

date2yyyymm.lo: \
libcompile date2yyyymm.c yyyymm.h
	./libcompile date2yyyymm.c

date822fmt.lo: \
libcompile date822fmt.c date822fmt.h
	./libcompile date822fmt.c

dateline.lo: \
libcompile dateline.c yyyymm.h cgi.h
	./libcompile dateline.c

decodeB.lo: \
libcompile decodeB.c messages.h die.h idx.h
	./libcompile decodeB.c

decodeHDR.lo: libcompile decodeHDR.c mime.h messages.h die.h idx.h
	./libcompile decodeHDR.c

decodeQ.lo: \
libcompile decodeQ.c messages.h mime.h die.h idx.h
	./libcompile decodeQ.c

die_badaddr.lo: \
libcompile die_badaddr.c messages.h die.h
	./libcompile die_badaddr.c

die_badformat.lo: \
libcompile die_badformat.c messages.h die.h
	./libcompile die_badformat.c

die_dow.lo: \
libcompile die_dow.c messages.h die.h
	./libcompile die_dow.c

die_nomem.lo: \
libcompile die_nomem.c messages.h die.h
	./libcompile die_nomem.c

die_sender.lo: \
libcompile die_sender.c messages.h die.h
	./libcompile die_sender.c

die_usage.lo: \
libcompile die_usage.c messages.h die.h
	./libcompile die_usage.c

direntry.h: \
compile trydrent.c direntry.h1 direntry.h2
	( ./compile trydrent.c >/dev/null 2>&1 \
	&& cat direntry.h2 || cat direntry.h1 ) > direntry.h
	rm -f trydrent.o

dl.lib: \
compile load trylib.c
	( ( ./compile trylib.c && ./load trylib -ldl ) >/dev/null 2>&1 && echo -ldl || exit 0 ) >dl.lib
	rm -f trylib.o trylib

dmarc.lo: \
libcompile dmarc.c die.h dmarc.h dns.h iopause.h
	./libcompile dmarc.c

dns_dfd.lo: \
libcompile dns_dfd.c dns.h iopause.h
	./libcompile dns_dfd.c

dns_domain.lo: \
libcompile dns_domain.c dns.h iopause.h
	./libcompile dns_domain.c

dns_dtda.lo: \
libcompile dns_dtda.c dns.h iopause.h
	./libcompile dns_dtda.c

dns_ip.lo: \
libcompile dns_ip.c dns.h iopause.h
	./libcompile dns_ip.c

dns_ipq.lo: libcompile dns_ipq.c dns.h iopause.h
	./libcompile dns_ipq.c

dns_mx.lo: libcompile dns_mx.c dns.h iopause.h
	./libcompile dns_mx.c

dns_name.lo: libcompile dns_name.c dns.h iopause.h
	./libcompile dns_name.c

dns_nd.lo: libcompile dns_nd.c dns.h iopause.h
	./libcompile dns_nd.c

dns_packet.lo: libcompile dns_packet.c dns.h iopause.h
	./libcompile dns_packet.c

dns_random.lo: libcompile dns_random.c dns.h iopause.h
	./libcompile dns_random.c

dns_rcip.lo: libcompile dns_rcip.c ip4.h dns.h iopause.h
	./libcompile dns_rcip.c

dns_rcrw.lo: libcompile dns_rcrw.c dns.h iopause.h
	./libcompile dns_rcrw.c

dns_resolve.lo: libcompile dns_resolve.c iopause.h dns.h iopause.h
	./libcompile dns_resolve.c

dns_sortip.lo: libcompile dns_sortip.c dns.h iopause.h
	./libcompile dns_sortip.c

dns_transmit.lo: libcompile dns_transmit.c socket.h dns.h iopause.h
	./libcompile dns_transmit.c

dns_txt.lo: libcompile dns_txt.c dns.h iopause.h
	./libcompile dns_txt.c

encodeB.lo: libcompile encodeB.c mime.h messages.h die.h idx.h
	./libcompile encodeB.c

encodeQ.lo: libcompile encodeQ.c messages.h mime.h die.h idx.h
	./libcompile encodeQ.c

ezmlm-accept: \
warn-auto.sh ezmlm-accept.sh
	cat warn-auto.sh ezmlm-accept.sh > ezmlm-accept
	chmod 755 ezmlm-accept

ezmlm-archive: \
load ezmlm-archive.o libezmlm.a
	./load ezmlm-archive -lezmlm -lqmail

ezmlm-archive.o: compile ezmlm-archive.c getconf.h \
getconfopt.h idxthread.h idx.h makehash.h die.h lockfile.h \
wrap.h idx.h messages.h config.h auto_version.h
	./compile ezmlm-archive.c

ezmlm-cgi: \
load ezmlm-cgi.o libezmlm.a
	./load ezmlm-cgi -lezmlm -lqmail

ezmlm-cgi.o: \
compile ezmlm-cgi.c direntry.h \
getconf.h subdb.h messages.h makehash.h mime.h wrap.h \
die.h idx.h yyyymm.h cgi.h auto_etc.h
	./compile ezmlm-cgi.c

ezmlm-check: \
warn-auto.sh ezmlm-check.sh
	cat warn-auto.sh ezmlm-check.sh > ezmlm-check
	chmod 755 ezmlm-check

ezmlm-checksub: \
load ezmlm-checksub.o libezmlm.a dl.lib
	./load ezmlm-checksub -lezmlm `cat dl.lib` -lqmail

ezmlm-checksub.o: compile ezmlm-checksub.c sender.h \
subdb.h getconfopt.h messages.h die.h idx.h config.h auto_version.h
	./compile ezmlm-checksub.c

ezmlm-clean: \
load ezmlm-clean.o libezmlm.a
	./load ezmlm-clean -lezmlm -lqmail

ezmlm-clean.o: compile ezmlm-clean.c getconf.h getconfopt.h \
qmail.h quote.h direntry.h cookie.h messages.h lockfile.h \
copy.h cookie.h hdr.h die.h idx.h mime.h \
config.h auto_version.h
	./compile ezmlm-clean.c

ezmlm-confirm: \
load ezmlm-confirm.o libezmlm.a
	./load ezmlm-confirm -lezmlm -lqmail

ezmlm-confirm.o: compile ezmlm-confirm.c sender.h \
qmail.h quote.h getconfopt.h lockfile.h \
cookie.h messages.h copy.h cookie.h wrap.h die.h \
idx.h mime.h config.h auto_version.h
	./compile ezmlm-confirm.c

ezmlm-cron: \
load ezmlm-cron.o libezmlm.a
	./load ezmlm-cron -lezmlm -lqmail

ezmlm-cron.o: compile ezmlm-cron.c getconfopt.h \
auto_qmail.h auto_cron.h auto_version.h messages.h die.h \
idx.h wrap.h lockfile.h
	./compile ezmlm-cron.c

ezmlm-dispatch: \
load ezmlm-dispatch.o libezmlm.a
	./load ezmlm-dispatch -lezmlm -lqmail

ezmlm-dispatch.o: compile ezmlm-dispatch.c sender.h getconfopt.h \
messages.h qmail.h wrap.h slurp.h die.h auto_version.h
	./compile ezmlm-dispatch.c

ezmlm-gate: \
load ezmlm-gate.o libezmlm.a dl.lib
	./load ezmlm-gate -lezmlm `cat dl.lib` -lqmail

ezmlm-gate.o: compile ezmlm-gate.c getconf.h auto_bin.h \
getconfopt.h messages.h die.h idx.h subdb.h wrap.h config.h \
auto_version.h
	./compile ezmlm-gate.c

ezmlm-get: \
load ezmlm-get.o libezmlm.a dl.lib
	./load ezmlm-get -lezmlm `cat dl.lib` -lqmail

ezmlm-get.o: compile ezmlm-get.c auto_version.h config.h cookie.h \
copy.h date822fmt.h die.h getconf.h getconfopt.h \
hdr.h idx.h idxthread.h makehash.h messages.h mime.h sender.h \
qmail.h quote.h subdb.h wrap.h lockfile.h gethdrln.h
	./compile ezmlm-get.c

ezmlm-glconf: \
warn-auto.sh ezmlm-glconf.sh
	cat warn-auto.sh ezmlm-glconf.sh > ezmlm-glconf
	chmod 755 ezmlm-glconf

ezmlm-idx: \
load ezmlm-idx.o libezmlm.a
	./load ezmlm-idx -lezmlm -lqmail

ezmlm-idx.o: compile ezmlm-idx.c slurp.h getconfopt.h \
idx.h mime.h wrap.h messages.h getconf.h makehash.h \
config.h auto_version.h
	./compile ezmlm-idx.c

ezmlm-idx.spec: \
ezmlm-idx.spec.template VERSION fill-template conf-release ChangeLog
	(cat ezmlm-idx.spec.template;./catChangeLog) | ./fill-template > $@

ezmlm-import: \
load ezmlm-import.o libezmlm.a
	./load ezmlm-import -lezmlm -lqmail

ezmlm-import.o: compile ezmlm-import.c getconf.h config.h messages.h \
die.h wrap.h idx.h getconfopt.h auto_version.h
	./compile ezmlm-import.c

ezmlm-issubn: \
load ezmlm-issubn.o libezmlm.a dl.lib
	./load ezmlm-issubn -lezmlm `cat dl.lib` -lqmail

ezmlm-issubn.o: compile ezmlm-issubn.c sender.h subdb.h \
getconfopt.h messages.h die.h idx.h config.h auto_version.h
	./compile ezmlm-issubn.c

ezmlm-limit: \
load ezmlm-limit.o libezmlm.a
	./load ezmlm-limit -lezmlm -lqmail

ezmlm-limit.o: compile ezmlm-limit.c getconf.h getconfopt.h \
messages.h die.h config.h idx.h
	./compile ezmlm-limit.c

ezmlm-list: \
load ezmlm-list.o libezmlm.a dl.lib
	./load ezmlm-list -lezmlm `cat dl.lib` -lqmail

ezmlm-list.o: compile ezmlm-list.c subdb.h getconfopt.h \
messages.h die.h idx.h config.h auto_version.h
	./compile ezmlm-list.c

ezmlm-make: \
load ezmlm-make.o libezmlm.a dl.lib
	./load ezmlm-make -lezmlm `cat dl.lib` -lqmail

ezmlm-make.o: compile ezmlm-make.c subdb.h wrap.h \
auto_bin.h messages.h die.h idx.h auto_etc.h auto_version.h
	./compile ezmlm-make.c

ezmlm-manage: \
load ezmlm-manage.o libezmlm.a dl.lib
	./load ezmlm-manage -lezmlm `cat dl.lib` -lqmail

ezmlm-manage.o: \
compile ezmlm-manage.c sender.h slurp.h getconf.h qmail.h \
quote.h subdb.h cookie.h getconfopt.h copy.h messages.h mime.h \
hdr.h die.h wrap.h idx.h config.h auto_version.h gethdrln.h
	./compile ezmlm-manage.c

ezmlm-moderate: \
load ezmlm-moderate.o libezmlm.a
	./load ezmlm-moderate -lezmlm -lqmail

ezmlm-moderate.o: compile ezmlm-moderate.c sender.h quote.h \
getconfopt.h cookie.h messages.h copy.h hdr.h mime.h die.h \
idx.h wrap.h config.h auto_version.h
	./compile ezmlm-moderate.c

ezmlmrc.all: \
lang/ch_GB/ezmlmrc lang/cs/ezmlmrc lang/da/ezmlmrc lang/de/ezmlmrc \
lang/en_US/ezmlmrc lang/es/ezmlmrc lang/fr/ezmlmrc lang/hu/ezmlmrc \
lang/id/ezmlmrc lang/it/ezmlmrc lang/ja/ezmlmrc lang/nl/ezmlmrc \
lang/pl/ezmlmrc lang/pt/ezmlmrc lang/pt_BR/ezmlmrc lang/ru/ezmlmrc \
lang/sv/ezmlmrc

ezmlmrc: \
ezmlmrc.template VERSION fill-template
	cat ezmlmrc.template | ./fill-template > $@

ezmlm-reject: \
load ezmlm-reject.o libezmlm.a
	./load ezmlm-reject -lezmlm -lqmail

ezmlm-reject.o: compile ezmlm-reject.c getconfopt.h getconf.h \
qmail.h sender.h messages.h mime.h die.h idx.h config.h \
auto_version.h gethdrln.h
	./compile ezmlm-reject.c

ezmlm-request: \
load ezmlm-request.o libezmlm.a dl.lib
	./load ezmlm-request -lezmlm `cat dl.lib` -lqmail

ezmlm-request.o: compile ezmlm-request.c qmail.h sender.h \
quote.h getconf.h getconfopt.h messages.h copy.h cookie.h subdb.h \
mime.h hdr.h die.h idx.h config.h auto_version.h gethdrln.h
	./compile ezmlm-request.c

ezmlm-return: \
load ezmlm-return.o libezmlm.a dl.lib
	./load ezmlm-return -lezmlm `cat dl.lib` -lqmail

ezmlm-return.o: compile ezmlm-return.c direntry.h sender.h \
slurpclose.h quote.h cookie.h getconfopt.h subdb.h messages.h \
die.h wrap.h config.h idx.h auto_version.h
	./compile ezmlm-return.c

ezmlm-rmtab: \
load ezmlm-rmtab.o libezmlm.a dl.lib
	./load ezmlm-rmtab -lezmlm `cat dl.lib` -lqmail

ezmlm-rmtab.o: \
compile ezmlm-rmtab.c subdb.h getconfopt.h messages.h die.h \
idx.h config.h auto_version.h
	./compile ezmlm-rmtab.c

ezmlm-send: \
load ezmlm-send.o libezmlm.a dl.lib
	./load ezmlm-send -lezmlm `cat dl.lib` -lqmail

ezmlm-send.o: compile ezmlm-send.c qmail.h \
sender.h getconf.h getconfopt.h quote.h subdb.h \
mime.h messages.h makehash.h cookie.h dmarc.h hdr.h \
die.h wrap.h idx.h copy.h cookie.h config.h \
auto_version.h gethdrln.h
	./compile ezmlm-send.c

ezmlm-split: \
load ezmlm-split.o libezmlm.a
	./load ezmlm-split -lezmlm -lqmail

ezmlm-split.o: compile ezmlm-split.c sender.h qmail.h \
getconfopt.h quote.h subhash.h messages.h die.h \
config.h idx.h auto_version.h
	./compile ezmlm-split.c

ezmlm-store: \
load ezmlm-store.o libezmlm.a dl.lib
	./load ezmlm-store -lezmlm `cat dl.lib` -lqmail

ezmlm-store.o: compile ezmlm-store.c qmail.h sender.h \
getconf.h cookie.h getconfopt.h messages.h quote.h hdr.h die.h \
idx.h copy.h subdb.h mime.h wrap.h config.h auto_version.h
	./compile ezmlm-store.c

ezmlm-sub: \
load ezmlm-sub.o ezmlm-subunsub.o libezmlm.a dl.lib
	./load ezmlm-sub ezmlm-subunsub.o -lezmlm `cat dl.lib` -lqmail

ezmlm-sub.o: \
compile ezmlm-sub.c
	./compile ezmlm-sub.c

ezmlm-subunsub.o: \
compile ezmlm-subunsub.c subdb.h getconfopt.h \
messages.h die.h idx.h config.h auto_version.h
	./compile ezmlm-subunsub.c

ezmlm-test: \
warn-auto.sh conf-qmail VERSION Makefile tests/00-config tests/01-misc \
tests/02-functions tests/09-getconfopt tests/100-ezmlm-make \
tests/110-ezmlm-reject tests/115-ezmlm-sub tests/116-ezmlm-checksub \
tests/119-ezmlm-nosql tests/119-ezmlm-sql tests/120-ezmlm-send \
tests/125-ezmlm-tstdig tests/130-ezmlm-weed tests/135-ezmlmrc \
tests/140-ezmlm-clean tests/145-ezmlm-store tests/150-ezmlm-return \
tests/155-ezmlm-warn tests/160-ezmlm-manage tests/165-ezmlm-request \
tests/170-ezmlm-split tests/180-ezmlm-gate tests/210-ezmlm-idx \
tests/221-ezmlm-get-index tests/222-ezmlm-get-get \
tests/223-ezmlm-get-thread tests/225-ezmlm-get-digest \
tests/260-ezmlm-manage tests/270-ezmlm-moderate tests/280-ezmlm-warn \
tests/290-ezmlm-archive tests/300-ezmlm-dispatch tests/310-dispatch-editor \
tests/400-decode-sender tests/500-export tests/504-flags \
tests/505-substs tests/506-messages tests/510-ezmlm-manage-subnop \
tests/510-ezmlm-manage-unsubnop tests/511-ezmlm-manage-subprobe \
tests/511-ezmlm-manage-unsubprobe tests/512-ezmlm-manage-subscribe \
tests/512-ezmlm-manage-unsubscribe tests/513-ezmlm-manage-modsub \
tests/513-ezmlm-manage-modunsub tests/514-ezmlm-manage-subbymod \
tests/514-ezmlm-manage-unsubbymod tests/519-ezmlm-manage-copylines \
tests/550-ezmlm-send tests/551-ezmlm-send-rewritefrom tests/560-addtrailer \
tests/570-omitbottom tests/90-cleanup tests/99-bugs
	(cat warn-auto.sh; \
	echo VER=\"`head -n 1 VERSION`\"; \
	cat tests/*-* ) >ezmlm-test;
	chmod 755 ezmlm-test

ezmlm-tstdig: \
load ezmlm-tstdig.o libezmlm.a
	./load ezmlm-tstdig -lezmlm -lqmail

ezmlm-tstdig.o: compile ezmlm-tstdig.c getconf.h \
getconfopt.h messages.h die.h wrap.h idx.h config.h
	./compile ezmlm-tstdig.c

ezmlm-unsub: \
load ezmlm-unsub.o ezmlm-subunsub.o libezmlm.a dl.lib
	./load ezmlm-unsub ezmlm-subunsub.o -lezmlm `cat dl.lib` -lqmail

ezmlm-unsub.o: \
compile ezmlm-unsub.c
	./compile ezmlm-unsub.c

ezmlm-warn: \
load ezmlm-warn.o libezmlm.a dl.lib
	./load ezmlm-warn -lezmlm `cat dl.lib` -lqmail

ezmlm-warn.o: compile ezmlm-warn.c direntry.h slurp.h getconfopt.h getconf.h \
cookie.h qmail.h messages.h quote.h copy.h \
mime.h hdr.h die.h wrap.h idx.h config.h subdb.h
	./compile ezmlm-warn.c

ezmlm-weed: \
load ezmlm-weed.o libezmlm.a
	./load ezmlm-weed -lezmlm -lqmail

ezmlm-weed.o: compile ezmlm-weed.c messages.h \
mime.h die.h gethdrln.h
	./compile ezmlm-weed.c

fill-template: \
warn-auto.sh fill-template.sh
	cat warn-auto.sh fill-template.sh > fill-template
	chmod 755 fill-template

find-systype: \
find-systype.sh auto-ccld.sh
	cat auto-ccld.sh find-systype.sh > find-systype
	chmod 755 find-systype

getconf.lo: libcompile getconf.c slurp.h getconf.h \
altpath.h die.h config.h copy.h cookie.h \
idx.h wrap.h messages.h
	./libcompile getconf.c

getconfopt_copy.lo: \
libcompile getconfopt_copy.c die.h getconfopt.h
	./libcompile getconfopt_copy.c

getconfopt_cstr_flag.lo: \
libcompile getconfopt_cstr_flag.c getconf.h getconfopt.h
	./libcompile getconfopt_cstr_flag.c

getconfopt_cstr.lo: \
libcompile getconfopt_cstr.c getconf.h getconfopt.h
	./libcompile getconfopt_cstr.c

getconfopt_flag.lo: \
libcompile getconfopt_flag.c getconf.h getconfopt.h
	./libcompile getconfopt_flag.c

getconfopt.lo: \
libcompile getconfopt.c config.h die.h getconf.h getconfopt.h
	./libcompile getconfopt.c

getconfopt_str.lo: \
libcompile getconfopt_str.c die.h getconf.h getconfopt.h
	./libcompile getconfopt_str.c

getconfopt_ulong_flag.lo: \
libcompile getconfopt_ulong_flag.c getconf.h getconfopt.h
	./libcompile getconfopt_ulong_flag.c

getconfopt_ulong.lo: \
libcompile getconfopt_ulong.c die.h getconf.h getconfopt.h
	./libcompile getconfopt_ulong.c

getconfopt_version.lo: \
libcompile getconfopt_version.c auto_version.h getconfopt.h
	./libcompile getconfopt_version.c

getconf_ulong.lo: \
libcompile getconf_ulong.c getconf.h die.h
	./libcompile getconf_ulong.c

gethdrln.lo: \
libcompile gethdrln.c
	./libcompile gethdrln.c

hasf: \
tryflock.c compile load
	( ( ./compile tryflock.c && ./load tryflock ) >/dev/null 2>&1 \
	&& echo \#define HASFLOCK 1 || exit 0 ) > hasf
	rm -f tryflock.o tryflock

hassgact.h: \
trysgact.c compile load
	( ( ./compile trysgact.c && ./load trysgact ) >/dev/null 2>&1 \
	&& echo \#define HASSIGACTION 1 || exit 0 ) > hassgact.h
	rm -f trysgact.o trysgact

haswaitp.h: \
choose compile haswaitp.h1 haswaitp.h2 load trywaitp.c
	./choose cl trywaitp haswaitp.h1 haswaitp.h2 > haswaitp.h

hdr_add.lo: \
libcompile hdr_add.c hdr.h qmail.h
	./libcompile hdr_add.c

hdr_boundary.lo: \
libcompile hdr_boundary.c hdr.h qmail.h makehash.h
	./libcompile hdr_boundary.c

hdr_ctboundary.lo: \
libcompile hdr_ctboundary.c hdr.h qmail.h
	./libcompile hdr_ctboundary.c

hdr_datemsgid.lo: libcompile hdr_datemsgid.c hdr.h qmail.h \
date822fmt.h makehash.h die.h idx.h
	./libcompile hdr_datemsgid.c

hdr_from.lo: libcompile hdr_from.c hdr.h qmail.h \
quote.h die.h idx.h
	./libcompile hdr_from.c

hdr_listsubject.lo: \
libcompile hdr_listsubject.c hdr.h qmail.h \
quote.h die.h
	./libcompile hdr_listsubject.c

hdr_mime.lo: libcompile hdr_mime.c hdr.h qmail.h makehash.h
	./libcompile hdr_mime.c

hdr_subject.lo: libcompile hdr_subject.c hdr.h qmail.h
	./libcompile hdr_subject.c

hdr_transferenc.lo: libcompile hdr_transferenc.c hdr.h qmail.h
	./libcompile hdr_transferenc.c

idxthread.lo: libcompile idxthread.c die.h idx.h \
messages.h makehash.h yyyymm.h lockfile.h
	./libcompile idxthread.c

INSTALL.cgi: INSTALL.cgi.in conf-cgidir
	cat INSTALL.cgi.in \
	| sed s}CGIDIR}"`head -1 conf-cgidir`"}g \
	> INSTALL.cgi

install: \
it man installer conf-bin conf-etc conf-lang conf-lib conf-man BIN SBIN ETC LIB MAN
	mkdir -p $(DESTDIR)"`head -n 1 conf-bin`"
	mkdir -p $(DESTDIR)"`head -n 1 conf-sbin`"
	mkdir -p $(DESTDIR)"`head -n 1 conf-etc`"
	mkdir -p $(DESTDIR)"`head -n 1 conf-man`"
	mkdir -p $(DESTDIR)"`head -n 1 conf-lib`"
	mkdir -p $(DESTDIR)"`head -n 1 conf-cgidir`"
	mkdir -p $(DESTDIR)$(prefix)/sbin
	mkdir -p $(DESTDIR)$(prefix)/share/docs/ezmlm-idx
	./installer $(DESTDIR)"`head -n 1 conf-bin`" < BIN
	./installer $(DESTDIR)"`head -n 1 conf-sbin`" < SBIN
	./installer $(DESTDIR)"`head -n 1 conf-etc`" < ETC
	./installer $(DESTDIR)"`head -n 1 conf-man`" < MAN
	./installer $(DESTDIR)"`head -n 1 conf-lib`" < LIB
	rm -f $(DESTDIR)"`head -n 1 conf-etc`"/default
	ln -sf "`head -n 1 conf-lang`" $(DESTDIR)"`head -n 1 conf-etc`"/default
	mv $(DESTDIR)"`head -n 1 conf-bin`"/ezmlm-cgi $(DESTDIR)"`head -n 1 conf-cgidir`"
	chmod 4755 "$(DESTDIR)"`head -n 1 conf-cgidir`"/ezmlm-cgi"
	cp README.mysql README.pgsql $(DESTDIR)$(prefix)/share/docs/ezmlm-idx
	cp BLURB CHANGES* FAQ README README.std ChangeLog $(DESTDIR)$(prefix)/share/docs/ezmlm-idx
	cp LICENSE THANKS TODO UPGRADE DOWNGRADE ezmlmrc.template $(DESTDIR)$(prefix)/share/docs/ezmlm-idx
	cp INSTALL.source INSTALL.cgi $(DESTDIR)$(prefix)/share/docs/ezmlm-idx

installer: \
load installer.o
	./load installer -lqmail

installer.o: \
compile installer.c
	./compile installer.c

iopause.h: \
choose compile load trypoll.c iopause.h1 iopause.h2
	./choose clr trypoll iopause.h1 iopause.h2 > iopause.h

iopause.lo: libcompile iopause.c select.h iopause.h
	./libcompile iopause.c

ip4_scan.lo: \
libcompile ip4_scan.c ip4.h
	./libcompile ip4_scan.c

it: \
ezmlm-accept ezmlm-archive ezmlm-check ezmlm-checksub ezmlm-cgi ezmlm-clean ezmlm-confirm \
ezmlm-cron ezmlm-dispatch ezmlm-gate ezmlm-get ezmlm-glconf ezmlm-idx ezmlm-import ezmlm-issubn \
ezmlm-limit ezmlm-list ezmlm-make ezmlm-manage ezmlm-moderate ezmlm-reject ezmlm-request ezmlm-return \
ezmlm-rmtab ezmlm-send ezmlm-split ezmlm-store ezmlm-sub ezmlm-tstdig ezmlm-unsub ezmlm-warn \
ezmlm-queue ezmlm-weed ezmlm-test sub-std.so ezmlmrc.all messages.all ezmlm-idx.spec test-getconfopt

lang/ch_GB/ezmlmrc: \
makelang ezmlmrc
	./makelang ch_GB

lang/cs/ezmlmrc: \
makelang ezmlmrc
	./makelang cs

lang/cs/text/messages: \
make-messages lang/cs/messages
	./make-messages < lang/cs/messages > lang/cs/text/messages

lang/da/ezmlmrc: \
makelang ezmlmrc
	./makelang da

lang/da/text/messages: \
make-messages lang/da/messages
	./make-messages < lang/da/messages > lang/da/text/messages

lang/de/ezmlmrc: \
makelang ezmlmrc
	./makelang de

lang/de/text/messages: \
make-messages lang/de/messages
	./make-messages < lang/de/messages > lang/de/text/messages

lang/en_US/ezmlmrc: \
makelang ezmlmrc
	./makelang en_US

lang/en_US/text/messages: \
make-messages lang/en_US/messages
	./make-messages < lang/en_US/messages > lang/en_US/text/messages

lang/es/ezmlmrc: \
makelang ezmlmrc
	./makelang es

lang/fr/ezmlmrc: \
makelang ezmlmrc
	./makelang fr

lang/fr/text/messages: \
make-messages lang/fr/messages
	./make-messages < lang/fr/messages > lang/fr/text/messages

lang/hu/ezmlmrc: \
makelang ezmlmrc
	./makelang hu

lang/hu/text/messages: \
make-messages lang/hu/messages
	./make-messages < lang/hu/messages > lang/hu/text/messages

lang/id/ezmlmrc: \
makelang ezmlmrc
	./makelang id

lang/id/text/messages: \
make-messages lang/id/messages
	./make-messages < lang/id/messages > lang/id/text/messages

lang/it/ezmlmrc: \
makelang ezmlmrc
	./makelang it

lang/it/text/messages: \
make-messages lang/it/messages
	./make-messages < lang/it/messages > lang/it/text/messages

lang/ja/ezmlmrc: \
makelang ezmlmrc
	./makelang ja

lang/nl/ezmlmrc: \
makelang ezmlmrc
	./makelang nl

lang/nl/text/messages: \
make-messages lang/nl/messages
	./make-messages < lang/nl/messages > lang/nl/text/messages

lang/pl/ezmlmrc: \
makelang ezmlmrc
	./makelang pl

lang/pl/text/messages: \
make-messages lang/pl/messages
	./make-messages < lang/pl/messages > lang/pl/text/messages

lang/pt_BR/ezmlmrc: \
makelang ezmlmrc
	./makelang pt_BR

lang/pt_BR/text/messages: \
make-messages lang/pt_BR/messages
	./make-messages < lang/pt_BR/messages > lang/pt_BR/text/messages

lang/pt/ezmlmrc: \
makelang ezmlmrc
	./makelang pt

lang/pt/text/messages: \
make-messages lang/pt/messages
	./make-messages < lang/pt/messages > lang/pt/text/messages

lang/ru/ezmlmrc: \
makelang ezmlmrc
	./makelang ru

lang/sv/ezmlmrc: \
makelang ezmlmrc
	./makelang sv

lang/sv/text/messages: \
make-messages lang/sv/messages
	./make-messages < lang/sv/messages > lang/sv/text/messages

libcompile: \
make-libcompile warn-auto.sh systype
	( cat warn-auto.sh; ./make-libcompile "`cat systype`" ) > libcompile
	chmod 755 libcompile

libezmlm.a: \
makelib altpath.lo author.lo auto_bin.lo \
auto_cron.lo auto_etc.lo auto_lib.lo auto_qmail.lo auto_version.lo \
concatHDR.lo config.lo getconf.lo \
cookie.lo copy.lo date2yyyymm.lo date822fmt.lo \
dateline.lo decodeB.lo decodeHDR.lo \
decodeQ.lo die_badaddr.lo die_badformat.lo die_dow.lo die_nomem.lo \
die_sender.lo die_usage.lo dmarc.lo dns_dfd.lo dns_domain.lo \
dns_dtda.lo dns_ip.lo dns_ipq.lo dns_mx.lo dns_name.lo dns_nd.lo \
dns_packet.lo dns_random.lo dns_rcip.lo dns_rcrw.lo dns_resolve.lo \
dns_sortip.lo dns_transmit.lo dns_txt.lo encodeB.lo encodeQ.lo \
getconf_ulong.lo gethdrln.lo getconfopt.lo \
getconfopt_copy.lo getconfopt_cstr.lo getconfopt_cstr_flag.lo \
getconfopt_flag.lo getconfopt_str.lo getconfopt_ulong.lo \
getconfopt_ulong_flag.lo getconfopt_version.lo hdr_add.lo \
hdr_boundary.lo hdr_ctboundary.lo hdr_datemsgid.lo hdr_from.lo \
hdr_listsubject.lo hdr_mime.lo hdr_subject.lo hdr_transferenc.lo \
idxthread.lo iopause.lo ip4_scan.lo lockfile.lo log.lo \
makehash.lo makepath.lo messages.lo qmail.lo qmail_copy.lo quote.lo \
sender.lo slurp.lo slurpclose.lo socket_bind.lo socket_conn.lo \
socket_tcp.lo socket_udp.lo subdb.lo subhash.lo surf.lo surfpcs.lo \
unfoldHDR.lo wrap_chdir.lo wrap_execbin.lo wrap_execsh.lo wrap_execv.lo \
wrap_exitcode.lo wrap_fork.lo wrap_rename.lo wrap_stat.lo wrap_waitpid.lo
	./makelib libezmlm.a altpath.lo author.lo auto_bin.lo \
	auto_cron.lo auto_etc.lo auto_lib.lo auto_qmail.lo auto_version.lo \
	concatHDR.lo config.lo cookie.lo copy.lo date2yyyymm.lo date822fmt.lo \
	dateline.lo decodeB.lo decodeHDR.lo getconf.lo \
	decodeQ.lo die_badaddr.lo die_badformat.lo die_dow.lo die_nomem.lo \
	die_sender.lo die_usage.lo dmarc.lo dns_dfd.lo dns_domain.lo \
	dns_dtda.lo dns_ip.lo dns_ipq.lo dns_mx.lo dns_name.lo dns_nd.lo \
	dns_packet.lo dns_random.lo dns_rcip.lo dns_rcrw.lo dns_resolve.lo \
	dns_sortip.lo dns_transmit.lo dns_txt.lo encodeB.lo encodeQ.lo \
	getconf_ulong.lo gethdrln.lo getconfopt.lo \
	getconfopt_copy.lo getconfopt_cstr.lo getconfopt_cstr_flag.lo \
	getconfopt_flag.lo getconfopt_str.lo getconfopt_ulong.lo \
	getconfopt_ulong_flag.lo getconfopt_version.lo hdr_add.lo \
	hdr_boundary.lo hdr_ctboundary.lo hdr_datemsgid.lo hdr_from.lo \
	hdr_listsubject.lo hdr_mime.lo hdr_subject.lo hdr_transferenc.lo \
	idxthread.lo iopause.lo ip4_scan.lo lockfile.lo log.lo \
	makehash.lo makepath.lo messages.lo qmail.lo qmail_copy.lo quote.lo \
	sender.lo slurp.lo slurpclose.lo socket_bind.lo socket_conn.lo \
	socket_tcp.lo socket_udp.lo subdb.lo subhash.lo surf.lo surfpcs.lo \
	unfoldHDR.lo wrap_chdir.lo wrap_execbin.lo wrap_execsh.lo wrap_execv.lo \
	wrap_exitcode.lo wrap_fork.lo wrap_rename.lo wrap_stat.lo wrap_waitpid.lo

load: \
make-load warn-auto.sh systype
	( cat warn-auto.sh; ./make-load "`cat systype`" ) > load
	chmod 755 load

lockfile.lo: \
libcompile lockfile.c messages.h die.h idx.h
	./libcompile lockfile.c

log.lo: libcompile log.c log.h sub_std.h
	./libcompile log.c

make-compile: \
make-compile.sh auto-ccld.sh
	cat auto-ccld.sh make-compile.sh > make-compile
	chmod 755 make-compile

makehash.lo: \
libcompile makehash.c surf.h makehash.h \
die.h idx.h surfpcs.h
	./libcompile makehash.c

makelang: \
warn-auto.sh makelang.sh
	cat warn-auto.sh makelang.sh > makelang
	chmod 755 makelang

make-libcompile: \
make-libcompile.sh auto-ccld.sh
	cat auto-ccld.sh make-libcompile.sh > make-libcompile
	chmod 755 make-libcompile

makelib: \
make-makelib warn-auto.sh systype
	( cat warn-auto.sh; ./make-makelib "`cat systype`" ) > makelib
	chmod 755 makelib

make-load: \
make-load.sh auto-ccld.sh
	cat auto-ccld.sh make-load.sh > make-load
	chmod 755 make-load

make-makelib: \
make-makelib.sh auto-ccld.sh
	cat auto-ccld.sh make-makelib.sh > make-makelib
	chmod 755 make-makelib

make-makeso: \
make-makeso.sh auto-ccld.sh
	cat auto-ccld.sh make-makeso.sh > make-makeso
	chmod 755 make-makeso

make-messages-c: \
make-messages-c.sh auto-ccld.sh
	cat auto-ccld.sh make-messages-c.sh > make-messages-c
	chmod 755 make-messages-c

make-messages: \
make-messages.sh auto-ccld.sh
	cat auto-ccld.sh make-messages.sh > make-messages
	chmod 755 make-messages

makepath.lo: \
libcompile makepath.c die.h sub_std.h
	./libcompile makepath.c

makeso: \
make-makeso warn-auto.sh systype
	( cat warn-auto.sh; ./make-makeso "`cat systype`" ) > makeso
	chmod 755 makeso

man: ezmlm-queue.1 INSTALL.cgi

messages.all: \
lang/cs/text/messages lang/da/text/messages lang/de/text/messages \
lang/en_US/text/messages lang/fr/text/messages lang/hu/text/messages \
lang/id/text/messages lang/it/text/messages lang/nl/text/messages \
lang/pl/text/messages lang/pt_BR/text/messages lang/pt/text/messages \
lang/sv/text/messages

messages.lo: \
libcompile messages.c messages.h altpath.h config.h \
copy.h cookie.h die.h slurp.h messages-txt.c
	./libcompile messages.c

messages-txt.c: \
make-messages-c conf-lang lang/cs/messages lang/da/messages \
lang/de/messages lang/en_US/messages lang/fr/messages lang/hu/messages \
lang/id/messages lang/it/messages lang/nl/messages lang/pl/messages \
lang/pt_BR/messages lang/pt/messages lang/sv/messages
	./make-messages-c < lang/$$(head -n 1 conf-lang)/messages >messages-txt.c

m.lib: \
compile load trylib.c
	( ( ./compile trylib.c && ./load trylib -lm ) >/dev/null 2>&1 && echo -lm || exit 0 ) >m.lib
	rm -f trylib.o trylib

mysql: \
sub-mysql.so

nsl.lib: \
compile load trylib.c
	( ( ./compile trylib.c && ./load trylib -lnsl ) >/dev/null 2>&1 && echo -lnsl || exit 0 ) >nsl.lib
	rm -f trylib.o trylib

pgsql: \
sub-pgsql.so

qmail_copy.lo: \
libcompile qmail_copy.c qmail.h
	./libcompile qmail_copy.c

qmail.lo: \
libcompile qmail.c die.h \
getconf.h qmail.h auto_qmail.h idx.h
	./libcompile qmail.c

quote.lo: \
libcompile quote.c quote.h
	./libcompile quote.c

select.h: \
choose compile trysysel.c select.h1 select.h2
	./choose c trysysel select.h1 select.h2 > select.h

sender.lo: \
libcompile sender.c die.h
	./libcompile sender.c

slurpclose.lo: \
libcompile slurpclose.c slurpclose.h
	./libcompile slurpclose.c

slurp.lo: \
libcompile slurp.c slurp.h slurpclose.h
	./libcompile slurp.c

socket_bind.lo: \
libcompile socket_bind.c socket.h
	./libcompile socket_bind.c

socket_conn.lo: \
libcompile socket_conn.c socket.h
	./libcompile socket_conn.c

socket_tcp.lo: \
libcompile socket_tcp.c socket.h
	./libcompile socket_tcp.c

socket_udp.lo: \
libcompile socket_udp.c socket.h
	./libcompile socket_udp.c

sqlite3: \
sub-sqlite3.so

subdb.lo: \
libcompile subdb.c config.h cookie.h die.h \
messages.h slurp.h subdb.h auto_lib.h
	./libcompile subdb.c

subhash.lo: \
libcompile subhash.c subhash.h
	./libcompile subhash.c

sub-mysql.lo: \
libcompile sub-mysql.c die.h sub_sql.h subdb.h subdb.h
	./libcompile sub-mysql.c

sub-mysql.so: \
makeso sub-mysql.lo sub_sql.lo libezmlm.a
	./makeso sub-mysql.so sub-mysql.lo sub_sql.lo -lezmlm \
	-lqmail -lmysqlclient

sub-pgsql.lo: \
libcompile sub-pgsql.c die.h sub_sql.h subdb.h
	./libcompile sub-pgsql.c

sub-pgsql.so: \
makeso sub-pgsql.lo sub_sql.lo libezmlm.a
	./makeso sub-pgsql.so sub-pgsql.lo sub_sql.lo -lqmail \
	-lezmlm -lpq

sub-sqlite3.lo: \
libcompile sub-sqlite3.c die.h sub_sql.h subdb.h subdb.h
	./libcompile sub-sqlite3.c

sub-sqlite3.so: \
makeso sub-sqlite3.lo sub_sql.lo libezmlm.a
	./makeso sub-sqlite3.so sub-sqlite3.lo sub_sql.lo -lqmail \
	-lezmlm -lsqlite3

sub_sql.lo: libcompile sub_sql.c cookie.h date822fmt.h die.h \
log.h messages.h sub_sql.h subdb.h subdb.h subhash.h
	./libcompile sub_sql.c

sub-std.lo: libcompile sub-std.c config.h cookie.h date822fmt.h die.h \
messages.h idx.h log.h makehash.h qmail.h slurp.h sub_std.h subhash.h \
subdb.h wrap.h
	./libcompile sub-std.c

sub-std.so: \
makeso sub-std.lo libezmlm.a
	./makeso sub-std.so sub-std.lo -lezmlm -lqmail

surf.lo: \
libcompile surf.c surf.h
	./libcompile surf.c

surfpcs.lo: \
libcompile surfpcs.c surf.h surfpcs.h
	./libcompile surfpcs.c

systype: \
find-systype trycpp.c
	./find-systype > systype

targets: \
all install

test-getconfopt: \
load test-getconfopt.o libezmlm.a
	./load test-getconfopt -lezmlm -lqmail

test-getconfopt.o: \
compile test-getconfopt.c getconfopt.h
	./compile test-getconfopt.c

unfoldHDR.lo: \
libcompile unfoldHDR.c messages.h mime.h die.h idx.h
	./libcompile unfoldHDR.c

wrap_chdir.lo: \
libcompile wrap_chdir.c messages.h wrap.h die.h
	./libcompile wrap_chdir.c

wrap_execbin.lo: \
libcompile wrap_execbin.c auto_bin.h wrap.h die.h idx.h
	./libcompile wrap_execbin.c

wrap_execsh.lo: \
libcompile wrap_execsh.c wrap.h
	./libcompile wrap_execsh.c

wrap_execv.lo: \
libcompile wrap_execv.c messages.h wrap.h die.h idx.h
	./libcompile wrap_execv.c

wrap_exitcode.lo: \
libcompile wrap_exitcode.c messages.h wrap.h die.h idx.h
	./libcompile wrap_exitcode.c

wrap_fork.lo: \
libcompile wrap_fork.c messages.h wrap.h die.h idx.h
	./libcompile wrap_fork.c

wrap_rename.lo: \
libcompile wrap_rename.c die.h messages.h wrap.h
	./libcompile wrap_rename.c

wrap_stat.lo: \
libcompile wrap_stat.c messages.h wrap.h die.h idx.h
	./libcompile wrap_stat.c

wrap_waitpid.lo: \
libcompile wrap_waitpid.c messages.h wrap.h die.h idx.h
	./libcompile wrap_waitpid.c

ezmlm-queue: ezmlm-queue.in conf-prefix conf-sysconfdir warn-auto.sh
	cat warn-auto.sh ezmlm-queue.in \
	| sed s}PREFIX}"`head -1 conf-prefix`"}g \
	| sed s}SYSCONFDIR}"`head -1 conf-sysconfdir`"}g \
	> ezmlm-queue
	chmod 755 ezmlm-queue

ezmlm-queue.1: ezmlm-queue.9 conf-sysconfdir
	cat ezmlm-queue.9 \
	| sed s}SYSCONFDIR}"`head -1 conf-sysconfdir`"}g \
	> ezmlm-queue.1
